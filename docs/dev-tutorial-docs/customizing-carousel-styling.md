# Customizing Carousel Styling

This guide explores the different ways you can customize the styling of Instagram carousels generated by the Instagram Carousel Generator API. Whether you want to match your brand colors, use custom fonts, or create unique layouts, this guide will show you how.

## Overview

The Instagram Carousel Generator offers several ways to customize the appearance of your carousels:

1. **Configuration Settings**: Adjust basic settings like dimensions and colors
2. **Custom Fonts**: Use your own fonts for a unique look
3. **Custom Image Service**: Create your own image service implementation
4. **Custom Templates**: Use different slide layouts for different types of content

## Basic Customization via Settings

### Setting Dimensions

You can customize the dimensions of your carousel slides by updating your configuration:

```bash
# In .env file
DEFAULT_WIDTH=1080
DEFAULT_HEIGHT=1080
```

Or by passing settings in your API request:

```json
{
  "carousel_title": "My Custom Carousel",
  "slides": [
    {"text": "This is slide 1"}
  ],
  "settings": {
    "width": 1080,
    "height": 1080
  }
}
```

### Customizing Colors

You can change the background color and other colors:

```bash
# In .env file
DEFAULT_BG_COLOR_R=18
DEFAULT_BG_COLOR_G=18
DEFAULT_BG_COLOR_B=18
```

Or in your API request:

```json
{
  "carousel_title": "My Custom Carousel",
  "slides": [
    {"text": "This is slide 1"}
  ],
  "settings": {
    "bg_color": [18, 18, 18],
    "text_color": [255, 255, 255]
  }
}
```

### Example: Creating a Light Theme Carousel

```json
{
  "carousel_title": "Light Theme Carousel",
  "slides": [
    {"text": "This is a light theme slide"}
  ],
  "settings": {
    "bg_color": [245, 245, 245],
    "text_color": [33, 33, 33]
  }
}
```

## Using Custom Fonts

### Adding Custom Fonts

1. Add your font files to the `static/assets` directory
2. Update your configuration:

```bash
# In .env file
DEFAULT_FONT=YourFont.ttf
DEFAULT_FONT_BOLD=YourFont-Bold.ttf
```

Or in your API request:

```json
{
  "carousel_title": "Custom Font Carousel",
  "slides": [
    {"text": "This uses a custom font"}
  ],
  "settings": {
    "title_font": "YourFont-Bold.ttf",
    "text_font": "YourFont.ttf",
    "nav_font": "YourFont.ttf"
  }
}
```

### Font Tips and Troubleshooting

- Use TrueType (.ttf) or OpenType (.otf) fonts
- Make sure your font supports the characters you're using
- If a font fails to load, the API will fall back to a system font
- For Unicode characters, use fonts with broad character support

### Example: Using Google Fonts

1. Download your preferred Google Fonts in TTF format
2. Add them to your `static/assets` directory
3. Reference them in your configuration:

```json
{
  "carousel_title": "Google Font Carousel",
  "slides": [
    {"text": "This uses Roboto font"}
  ],
  "settings": {
    "title_font": "Roboto-Bold.ttf",
    "text_font": "Roboto-Regular.ttf"
  }
}
```

## Advanced Customization with Custom Image Service

For more advanced customization, you can create a custom image service implementation. This approach gives you complete control over the rendering process.

### Creating a Custom Image Service

1. Create a new Python file in `app/services/image_service` (see [Creating a Custom Image Service](tutorials/custom-image-service.md))
2. Implement your custom styling logic
3. Register your service with the service provider
4. Create an API endpoint that uses your custom service

### Styling Examples You Can Implement

#### Gradient Backgrounds

```python
def create_slide_image(self, title, text, slide_number, total_slides, include_logo=False, logo_path=None):
    # Create base image
    image = Image.new("RGB", (self.default_width, self.default_height))
    draw = ImageDraw.Draw(image)

    # Create gradient background
    for y in range(self.default_height):
        r = int(10 + (y / self.default_height) * 20)
        g = int(10 + (y / self.default_height) * 20)
        b = int(40 + (y / self.default_height) * 30)
        draw.line([(0, y), (self.default_width, y)], fill=(r, g, b))

    # Rest of your implementation...
```

#### Rounded Corners

```python
def apply_rounded_corners(self, image, radius):
    circle = Image.new('L', (radius * 2, radius * 2), 0)
    draw = ImageDraw.Draw(circle)
    draw.ellipse((0, 0, radius * 2, radius * 2), fill=255)

    alpha = Image.new('L', image.size, 255)
    w, h = image.size

    # Apply corner masks
    alpha.paste(circle.crop((0, 0, radius, radius)), (0, 0))
    alpha.paste(circle.crop((radius, 0, radius * 2, radius)), (w - radius, 0))
    alpha.paste(circle.crop((0, radius, radius, radius * 2)), (0, h - radius))
    alpha.paste(circle.crop((radius, radius, radius * 2, radius * 2)), (w - radius, h - radius))

    image.putalpha(alpha)
    return image
```

#### Custom Text Effects

```python
def create_shadow_text(self, draw, text, position, font, color=(255, 255, 255), shadow_color=(0, 0, 0, 128)):
    # Draw shadow slightly offset
    shadow_pos = (position[0] + 2, position[1] + 2)
    draw.text(shadow_pos, text, font=font, fill=shadow_color)

    # Draw main text
    draw.text(position, text, font=font, fill=color)
```

## Creating Layout Templates

You can create different slide layouts for different types of content.

### Example: Quote Layout

```python
def create_quote_slide(self, quote, author, slide_number, total_slides):
    # Create base image
    image = Image.new("RGB", (self.default_width, self.default_height), self.default_bg_color)
    draw = ImageDraw.Draw(image)

    # Load fonts
    quote_font = self.safe_load_font(self.default_font_bold, 48)
    author_font = self.safe_load_font(self.default_font, 32)

    # Add quotation marks
    draw.text((100, 300), """, fill=(120, 120, 255), font=quote_font, size=120)

    # Add quote text
    wrapped_quote = self._wrap_text(draw, quote, quote_font, self.default_width - 200)
    y = 350
    for line in wrapped_quote:
        draw.text((self.default_width/2, y), line, fill="white", font=quote_font, anchor="mm")
        y += 60

    # Add author
    draw.text((self.default_width/2, y + 50), f"â€” {author}", fill=(200, 200, 200), font=author_font, anchor="mm")

    # Add navigation
    self._add_navigation(draw, slide_number, total_slides)

    return image
```

### Example: "Big Number" Layout

```python
def create_number_slide(self, number, label, description, slide_number, total_slides):
    # Create base image
    image = Image.new("RGB", (self.default_width, self.default_height), self.default_bg_color)
    draw = ImageDraw.Draw(image)

    # Load fonts
    number_font = self.safe_load_font(self.default_font_bold, 150)
    label_font = self.safe_load_font(self.default_font_bold, 40)
    desc_font = self.safe_load_font(self.default_font, 32)

    # Add big number
    draw.text((self.default_width/2, 350), number, fill=(100, 180, 255), font=number_font, anchor="mm")

    # Add label
    draw.text((self.default_width/2, 500), label.upper(), fill="white", font=label_font, anchor="mm")

    # Add description
    wrapped_desc = self._wrap_text(draw, description, desc_font, self.default_width - 200)
    y = 570
    for line in wrapped_desc:
        draw.text((self.default_width/2, y), line, fill=(200, 200, 200), font=desc_font, anchor="mm")
        y += 40

    # Add navigation
    self._add_navigation(draw, slide_number, total_slides)

    return image
```

## Branding Your Carousels

### Adding Logos

You can include your logo on each slide:

```json
{
  "carousel_title": "Branded Carousel",
  "slides": [
    {"text": "This includes our logo"}
  ],
  "include_logo": true,
  "logo_path": "/path/to/your/logo.png"
}
```

Tips for logos:
- Use PNG format with transparency
- Optimize for size and visibility
- Position consistently across slides

### Custom Branding Elements

You can add other branding elements in a custom image service:

```python
def _add_branding_elements(self, draw, width, height):
    # Add brand colors as decorative elements
    brand_color = (65, 105, 225)  # Royal Blue

    # Add color bar at top
    draw.rectangle([(0, 0), (width, 10)], fill=brand_color)

    # Add company name
    company_font = self.safe_load_font(self.default_font_bold, 24)
    draw.text((width - 20, height - 20), "YOUR COMPANY", fill=brand_color, font=company_font, anchor="rb")
```

## Creating Themed Slide Sets

You can create themed slide sets for different types of content:

### Example: Educational Theme

```python
class EducationalImageService(BaseImageService):
    def create_slide_image(self, title, text, slide_number, total_slides, include_logo=False, logo_path=None):
        # Create base image with light background
        image = Image.new("RGB", (self.default_width, self.default_height), (245, 245, 245))
        draw = ImageDraw.Draw(image)

        # Add notebook paper lines
        for y in range(100, self.default_height, 40):
            draw.line([(40, y), (self.default_width - 40, y)], fill=(200, 200, 220), width=1)

        # Add vertical red margin
        draw.line([(80, 100), (80, self.default_height - 100)], fill=(220, 100, 100), width=2)

        # Add title with school-themed color
        title_font = self.safe_load_font(self.default_font_bold, 60)
        if title:
            draw.text((self.default_width/2, 60), title, fill=(80, 80, 160), font=title_font, anchor="mm")

        # Add text in dark color for readability
        text_font = self.safe_load_font(self.default_font, 48)
        wrapped_text = self._wrap_text(draw, text, text_font, self.default_width - 200)
        y = self.default_height/2 - len(wrapped_text) * 30

        for line in wrapped_text:
            draw.text((self.default_width/2, y), line, fill=(50, 50, 80), font=text_font, anchor="mm")
            y += 60

        # Add slide number like a page number
        draw.text(
            (self.default_width - 50, self.default_height - 50),
            f"{slide_number}/{total_slides}",
            fill=(100, 100, 150),
            font=self.safe_load_font(self.default_font, 30),
            anchor="rb"
        )

        return image
```

### Example: Corporate Theme

```python
class CorporateImageService(BaseImageService):
    def create_slide_image(self, title, text, slide_number, total_slides, include_logo=False, logo_path=None):
        # Create base image with professional dark blue background
        image = Image.new("RGB", (self.default_width, self.default_height), (20, 40, 80))
        draw = ImageDraw.Draw(image)

        # Add subtle gradient overlay
        for y in range(self.default_height):
            opacity = int(50 * (1 - y / self.default_height))
            draw.line([(0, y), (self.default_width, y)], fill=(255, 255, 255, opacity))

        # Add professional corner accent
        draw.rectangle([(0, 0), (20, self.default_height)], fill=(0, 120, 200))

        # Add title with corporate styling
        title_font = self.safe_load_font(self.default_font_bold, 60)
        if title:
            # Create background bar for title
            title_bar_height = 100
            draw.rectangle(
                [(50, 50), (self.default_width - 50, 50 + title_bar_height)],
                fill=(30, 50, 90)
            )
            draw.text((self.default_width/2, 100), title, fill=(220, 220, 240), font=title_font, anchor="mm")

        # Add text in light color
        text_font = self.safe_load_font(self.default_font, 48)
        wrapped_text = self._wrap_text(draw, text, text_font, self.default_width - 200)
        y = self.default_height/2 - len(wrapped_text) * 30

        for line in wrapped_text:
            draw.text((self.default_width/2, y), line, fill=(240, 240, 255), font=text_font, anchor="mm")
            y += 60

        # Add footer bar
        footer_height = 80
        draw.rectangle(
            [(0, self.default_height - footer_height), (self.default_width, self.default_height)],
            fill=(30, 50, 90)
        )

        # Add slide number and company name in footer
        nav_font = self.safe_load_font(self.default_font, 30)
        draw.text(
            (100, self.default_height - footer_height/2),
            "ACME CORPORATION",
            fill=(180, 180, 220),
            font=nav_font,
            anchor="lm"
        )
        draw.text(
            (self.default_width - 100, self.default_height - footer_height/2),
            f"{slide_number}/{total_slides}",
            fill=(180, 180, 220),
            font=nav_font,
            anchor="rm"
        )

        # Add logo if requested
        if include_logo and logo_path:
            self._add_logo(image, logo_path, position=(self.default_width/2, self.default_height - footer_height/2))

        return image
```

## Responsive Design Techniques

Even though Instagram has fixed dimensions for carousel posts, you can design your slides to be responsive to different content lengths:

### Dynamic Text Sizing

```python
def _get_dynamic_font_size(self, draw, text, max_width, max_height, font_path, start_size=60, min_size=24):
    """Determine the optimal font size based on text length."""
    size = start_size

    while size > min_size:
        font = self.safe_load_font(font_path, size)
        lines = self._wrap_text(draw, text, font, max_width)

        # Calculate total height
        total_height = len(lines) * (size + 10)  # font size plus line spacing

        if total_height <= max_height:
            return font, lines

        # Reduce size and try again
        size -= 4

    # Return minimum size if we get here
    font = self.safe_load_font(font_path, min_size)
    lines = self._wrap_text(draw, text, font, max_width)
    return font, lines
```

### Content-Aware Layout

```python
def create_content_aware_slide(self, title, text, slide_number, total_slides):
    # Create base image
    image = Image.new("RGB", (self.default_width, self.default_height), self.default_bg_color)
    draw = ImageDraw.Draw(image)

    # Load fonts
    title_font = self.safe_load_font(self.default_font_bold, 60)

    # Determine the best layout based on content
    if len(text) < 100:
        # Short text - use centered layout with large font
        text_font = self.safe_load_font(self.default_font, 60)
        layout = "centered"
    elif len(text) < 300:
        # Medium text - use standard layout
        text_font = self.safe_load_font(self.default_font, 48)
        layout = "standard"
    else:
        # Long text - use compact layout with smaller font
        text_font, wrapped_text = self._get_dynamic_font_size(
            draw, text, self.default_width - 120, self.default_height - 300,
            self.default_font, start_size=40, min_size=24
        )
        layout = "compact"

    # Apply the chosen layout
    if layout == "centered":
        # Center everything
        if title:
            draw.text((self.default_width/2, 150), title, fill="white", font=title_font, anchor="mm")

        wrapped_text = self._wrap_text(draw, text, text_font, self.default_width - 200)
        y = self.default_height/2 - len(wrapped_text) * 30

        for line in wrapped_text:
            draw.text((self.default_width/2, y), line, fill="white", font=text_font, anchor="mm")
            y += 70

    elif layout == "standard":
        # Standard layout with title at top, text in middle
        if title:
            draw.text((self.default_width/2, 150), title, fill="white", font=title_font, anchor="mm")

        wrapped_text = self._wrap_text(draw, text, text_font, self.default_width - 200)
        y = self.default_height/2 - len(wrapped_text) * 30

        for line in wrapped_text:
            draw.text((self.default_width/2, y), line, fill="white", font=text_font, anchor="mm")
            y += 60

    else:  # compact
        # Compact layout for longer text
        if title:
            draw.text((self.default_width/2, 100), title, fill="white", font=title_font, anchor="mm")

        y = 200
        for line in wrapped_text:
            draw.text((self.default_width/2, y), line, fill="white", font=text_font, anchor="mm")
            y += text_font.size + 10

    # Add navigation regardless of layout
    self._add_navigation(draw, slide_number, total_slides)

    return image
```

## CSS-Inspired Styling System

You can implement a CSS-inspired styling system for more flexibility:

```python
class StyledImageService(BaseImageService):
    def __init__(self, settings=None):
        super().__init__(settings)
        # Default style
        self.style = {
            "background": {
                "color": (18, 18, 18),
                "gradient": False
            },
            "text": {
                "color": (255, 255, 255),
                "align": "center",
                "font_size": 48,
                "line_height": 1.2
            },
            "title": {
                "color": (255, 255, 255),
                "align": "center",
                "font_size": 60,
                "gradient": True
            },
            "spacing": {
                "padding": 40,
                "margin": 20
            },
            "effects": {
                "rounded_corners": 0,
                "drop_shadow": False
            }
        }

        # Update with custom style if provided
        if "style" in self.settings:
            self._update_style_recursive(self.style, self.settings["style"])

    def _update_style_recursive(self, target, source):
        """Update style dictionary recursively."""
        for key, value in source.items():
            if key in target and isinstance(target[key], dict) and isinstance(value, dict):
                self._update_style_recursive(target[key], value)
            else:
                target[key] = value

    def create_slide_image(self, title, text, slide_number, total_slides, include_logo=False, logo_path=None):
        # Apply styling defined in self.style
        # ...implementation
```

Usage example:

```json
{
  "carousel_title": "Styled Carousel",
  "slides": [
    {"text": "This uses a CSS-like styling system"}
  ],
  "settings": {
    "style": {
      "background": {
        "color": [30, 30, 60],
        "gradient": true
      },
      "text": {
        "color": [220, 220, 255],
        "font_size": 42
      },
      "effects": {
        "rounded_corners": 20
      }
    }
  }
}
```

## Customization Best Practices

### Maintaining Brand Consistency

1. **Define brand guidelines**: Create a style guide with colors, fonts, and layout rules
2. **Create reusable templates**: Build templates for different content types
3. **Use consistent elements**: Keep logos, colors, and formatting consistent across carousels
4. **Test on Instagram**: Preview your designs on actual Instagram to ensure they look good

### Performance Considerations

1. **Optimize image processing**: Balance quality and performance
2. **Cache common elements**: Pre-render elements that don't change
3. **Be mindful of memory usage**: Large images can consume significant memory
4. **Test with realistic content**: Ensure your custom styling works with real-world content

### Accessibility Tips

1. **Maintain good contrast**: Ensure text is readable against backgrounds
2. **Use sufficient font sizes**: Don't make text too small
3. **Avoid relying solely on color**: Use additional visual indicators
4. **Test with screen readers**: Consider how your content might be consumed by assistive technologies

## Conclusion

Customization is one of the key strengths of the Instagram Carousel Generator API. Whether you need simple color adjustments or completely custom layouts, the system provides multiple ways to achieve your design goals.

By leveraging configuration settings, custom services, or layout templates, you can create Instagram carousels that perfectly match your brand and engage your audience.

## Next Steps

1. Start with basic customization through configuration settings
2. Experiment with custom fonts to enhance your brand identity
3. Create a custom image service for more advanced styling needs
4. Develop templates for different types of content

Remember to test your customizations thoroughly and gather feedback from your audience to continually refine your carousel designs.
